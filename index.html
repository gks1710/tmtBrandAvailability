<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TMT WhatsApp Message Generator</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
  background:#f3f4f6;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
.card{
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.06);
}
.input{
  border:1px solid #d1d5db;
  border-radius:8px;
  padding:6px 8px;
}
.whatsapp{
  white-space:pre-wrap;
  font-family: monospace;
  background:#f8fafc;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="max-w-7xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 gap-4">

<!-- LEFT -->
<div class="space-y-4">

<div class="flex gap-2">
<button onclick="toggle('sizePanel')" class="bg-blue-600 text-white px-4 py-2 rounded">Manage Sizes</button>
<button onclick="toggle('productPanel')" class="bg-indigo-600 text-white px-4 py-2 rounded">Manage Products</button>
</div>

<div id="sizePanel" class="card p-4 hidden">
<h2 class="font-bold mb-2">üìè Size Master</h2>
<div class="flex gap-2 mb-2">
<input id="newSize" type="number" placeholder="Size mm" class="input w-full">
<button onclick="addSize()" class="bg-blue-600 text-white px-4 rounded">Add</button>
</div>
<div id="sizeList" class="space-y-1 max-h-40 overflow-auto"></div>
</div>

<div id="productPanel" class="card p-4 hidden">
<h2 class="font-bold mb-2">‚ûï Add / Edit Product</h2>

<select id="pType" class="input w-full mb-2" onchange="toggleSizeSelect()">
<option value="range">Range</option>
<option value="single">Single</option>
<option value="raigarh">Raigarh Static</option>
<option value="sauda">Sauda Static</option>
</select>

<input id="pName" type="text" placeholder="Product Name" class="input w-full mb-2">

<div id="sizeSelectBox" class="mb-2">
<p class="text-sm font-semibold mb-1">Available Sizes</p>
<div id="sizeCheckboxes" class="grid grid-cols-3 gap-2"></div>
</div>

<button onclick="saveProduct()" class="w-full bg-green-600 text-white py-2 rounded font-bold">Save</button>

<hr class="my-3">
<div id="productList" class="space-y-2 max-h-56 overflow-auto"></div>
</div>

<div class="card p-4">
<h2 class="font-bold mb-2">Select Products</h2>
<select id="viewType" class="input w-full mb-2" onchange="renderSelection()">
<option value="range">Range</option>
<option value="single">Single</option>
<option value="raigarh">Raigarh</option>
<option value="sauda">Sauda</option>
</select>
<div id="selectionBox" class="space-y-2"></div>
</div>

</div>

<!-- RIGHT -->
<div class="card p-4 flex flex-col">
<h2 class="text-xl font-bold text-green-700 mb-2">WhatsApp Preview</h2>
<button onclick="copyMsg()" class="bg-green-600 text-white py-2 rounded mb-2 font-bold">Copy</button>
<div id="output" class="whatsapp p-3 rounded border flex-grow overflow-auto"></div>
</div>

</div>

<script>
const SIZE_KEY="sizes";
const PRODUCT_KEY="products";
const SELECT_KEY="selected";

let sizes=[], products=[], selected={}, editId=null;

const $=id=>document.getElementById(id);
const today=()=>new Date().toLocaleDateString("en-GB").replace(/\//g,"-");

function toggle(id){$(id).classList.toggle("hidden");}

function load(){
 sizes=JSON.parse(localStorage.getItem(SIZE_KEY))||[8,10,12,16,28,32];
 products=JSON.parse(localStorage.getItem(PRODUCT_KEY))||[];
 selected=JSON.parse(localStorage.getItem(SELECT_KEY))||{};
 saveAll(); renderSizes(); renderProducts(); renderSelection();
}
function saveAll(){
 localStorage.setItem(SIZE_KEY,JSON.stringify(sizes));
 localStorage.setItem(PRODUCT_KEY,JSON.stringify(products));
 localStorage.setItem(SELECT_KEY,JSON.stringify(selected));
}

/* SIZE */
function renderSizes(){
 const box=$("sizeList"); box.innerHTML="";
 sizes.sort((a,b)=>a-b).forEach((s,i)=>{
  box.innerHTML+=`
  <div class="flex justify-between bg-gray-100 p-2 rounded">
   <span>${s} mm</span>
   <div>
    <button onclick="editSize(${i})" class="text-blue-600 text-xs">Edit</button>
    <button onclick="delSize(${i})" class="text-red-600 text-xs ml-2">Del</button>
   </div>
  </div>`;
 });
 renderSizeChecks();
}
function addSize(){
 const v=parseInt($("newSize").value);
 if(!v||sizes.includes(v))return;
 sizes.push(v); $("newSize").value="";
 saveAll(); renderSizes();
}
function editSize(i){
 const v=parseInt(prompt("New size",sizes[i]));
 if(!v||sizes.includes(v))return;
 sizes[i]=v; saveAll(); renderSizes();
}
function delSize(i){
 if(confirm("Delete size?")){sizes.splice(i,1); saveAll(); renderSizes();}
}

/* PRODUCTS */
function toggleSizeSelect(){
 $("sizeSelectBox").style.display = $("pType").value==="range"?"block":"none";
}
function renderSizeChecks(){
 const box=$("sizeCheckboxes"); box.innerHTML="";
 sizes.forEach(s=>{
  box.innerHTML+=`
  <label class="flex gap-1 items-center">
   <input type="checkbox" value="${s}">
   <span>${s}mm</span>
  </label>`;
 });
}
function saveProduct(){
 const name=$("pName").value.trim();
 const type=$("pType").value;
 if(!name)return alert("Enter name");

 let selSizes=[];
 if(type==="range"){
  document.querySelectorAll("#sizeCheckboxes input:checked")
   .forEach(c=>selSizes.push(+c.value));
 }

 if(editId){
  let p=products.find(x=>x.id===editId);
  Object.assign(p,{name,type,sizes:selSizes});
 }else{
  products.push({id:Date.now()+"",name,type,sizes:selSizes,extra:0});
 }

 editId=null; $("pName").value=""; saveAll();
 renderProducts(); renderSelection();
}
function renderProducts(){
 const box=$("productList"); box.innerHTML="";
 products.sort((a,b)=>a.name.localeCompare(b.name)).forEach(p=>{
  box.innerHTML+=`
  <div class="flex justify-between bg-gray-100 p-2 rounded">
   <span>${p.name} (${p.type})</span>
   <div>
    <button onclick="editProduct('${p.id}')" class="text-blue-600 text-xs">Edit</button>
    <button onclick="delProduct('${p.id}')" class="text-red-600 text-xs ml-2">Del</button>
   </div>
  </div>`;
 });
}
function editProduct(id){
 const p=products.find(x=>x.id===id);
 editId=id; $("pName").value=p.name; $("pType").value=p.type;
 toggleSizeSelect();
 document.querySelectorAll("#sizeCheckboxes input")
  .forEach(c=>c.checked=p.sizes.includes(+c.value));
}
function delProduct(id){
 if(confirm("Delete product?")){
  products=products.filter(p=>p.id!==id);
  delete selected[id];
  saveAll(); renderProducts(); renderSelection();
 }
}

/* SELECTION */
function renderSelection(){
 const type=$("viewType").value;
 const box=$("selectionBox"); box.innerHTML="";
 products.filter(p=>p.type===type)
 .sort((a,b)=>a.name.localeCompare(b.name))
 .forEach(p=>{
  const chk=selected[p.id]?.on?"checked":"";
  const ex=selected[p.id]?.extra||0;
  box.innerHTML+=`
  <div class="flex gap-2 items-center border p-2 rounded">
   <input type="checkbox" ${chk} onchange="sel('${p.id}',this.checked)">
   <span class="flex-grow font-semibold">${p.name}</span>
   <input type="number" value="${ex}" class="input w-20"
    oninput="setExtra('${p.id}',this.value)">
  </div>`;
 });
 generate();
}
function sel(id,v){
 selected[id]=selected[id]||{}; selected[id].on=v;
 saveAll(); generate();
}
function setExtra(id,v){
 selected[id]=selected[id]||{}; selected[id].extra=parseInt(v)||0;
 saveAll(); generate();
}

/* MESSAGE */
function generate(){
 let m=`AR Enterprises\nüìÖ ${today()}\n\n`;

 products.filter(p=>p.type==="range"&&selected[p.id]?.on)
 .sort((a,b)=>a.name.localeCompare(b.name))
 .forEach(p=>{
  const e=selected[p.id]?.extra||0;
  const sizesText=p.sizes.sort((a,b)=>a-b).join(", ");
  m+=`*‚ñ∂ ${p.name}${e>0?` +${e}`:""}*\n ${sizesText} mm\n`;
 });

 const r=products.filter(p=>p.type==="raigarh"&&selected[p.id]?.on);
 if(r.length){
  m+=`\nüåÜ*RAIGARH TMT*\n`;
  r.sort((a,b)=>a.name.localeCompare(b.name))
   .forEach(p=>{
    const e=selected[p.id]?.extra||0;
    m+=`‚ñ∂ ${p.name}${e>0?` +${e}`:""}\n`;
   });
 }

 const s=products.filter(p=>
  (p.type==="single"||p.type==="sauda")&&selected[p.id]?.on);
 if(s.length){
  m+=`\nüì¶*Separate Sauda*\n`;
  s.sort((a,b)=>a.name.localeCompare(b.name))
   .forEach(p=>{
    const e=selected[p.id]?.extra||0;
    m+=`‚ñ∂ ${p.name}${e>0?` +${e}`:""}\n`;
   });
 }

 $("output").innerText=m;
}

function copyMsg(){
 navigator.clipboard.writeText($("output").innerText).then(()=>alert("Copied"));
}

window.onload=load;
</script>

</body>
</html>
